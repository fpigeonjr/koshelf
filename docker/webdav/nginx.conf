events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;

        location /books/ {
            alias /var/lib/dav/books/;
            
            dav_methods PUT DELETE MKCOL COPY MOVE;
            dav_ext_methods PROPFIND OPTIONS;
            dav_access user:rw group:rw all:r;
            
            create_full_put_path on;
            client_max_body_size 100M;
            
            auth_basic "WebDAV Books";
            auth_basic_user_file /etc/nginx/.htpasswd;
        }

        location /koreader-settings/ {
            alias /var/lib/dav/koreader-settings/;
            
            dav_methods PUT DELETE MKCOL COPY MOVE;
            dav_ext_methods PROPFIND OPTIONS;
            dav_access user:rw group:rw all:r;
            
            create_full_put_path on;
            client_max_body_size 10M;
            
            auth_basic "WebDAV KOReader Settings";
            auth_basic_user_file /etc/nginx/.htpasswd;
        }

        location / {
            return 200 "WebDAV server is running\n";
            add_header Content-Type text/plain;
        }
    }
}